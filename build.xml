<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="jFreeRails" default="bindist" basedir=".">
   <description>The aim of the FreeRails project is to create a fun game based off the RailRoad Tycoon and RailRoad Tycoon II games.</description>

   <target name="init" depends="properties">
      <tstamp />

      <property name="src" location="src" />

      <property name="build" location="build" />

      <property name="dist" location="dist" />

      <property name="doc" location="javadoc" />

      <property name="temp" location="temp" />
   </target>

   <target name="mkdirs" depends="init">
      <tstamp />

      <mkdir dir="${build}" />

      <mkdir dir="${dist}/lib" />
   </target>

   <target name="properties" if="eclipse.running">
      <property name="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter" />
   </target>

   <target name="copydata" depends="init" description="Copy data files">
      <copy todir="${build}/jfreerails/data">
         <fileset dir="${src}/jfreerails/data">
            <include name="*.xml" />

            <include name="*.png" />

            <include name="*.dtd" />
            
             <include name="*.gif" />
         </fileset>
      </copy>

      <copy todir="${build}">
         <fileset dir=".">
            <include name="README" />

            <include name="TODO" />

            <include name="ChangeLog" />
         </fileset>
      </copy>
   </target>

   <target name="compile" depends="copydata" description="Build everything except JUnit test-classes">
      <javac srcdir="${src}" destdir="${build}" fork="true">
         <exclude name="**/*Test.java" />
      </javac>
   </target>

   <target name="debugcompile" depends="copydata" description="Build everything including JUnit test-classes">
      <javac srcdir="${src}" destdir="${build}" fork="true" />
   </target>

   <target name="runtests" depends="debugcompile" description="Run all junit tests">
      <junit printsummary="yes" haltonfailure="yes">
         <classpath>
            <pathelement location="${build}" />

            <pathelement path="${java.class.path}" />
         </classpath>

         <formatter type="brief" usefile="no" />

         <batchtest fork="yes">
            <fileset dir="${build}">
               <include name="**/*Test.class" />
            </fileset>
         </batchtest>
      </junit>
   </target>

   <target name="bindist" depends="compile, mkdirs" description="Generate binary distribution">
      <jar destfile="${dist}/lib/jFreeRails-${DSTAMP}-bin.jar" basedir="${build}">
         <manifest>
            <attribute name="Main-Class" value="jfreerails.RunFreerails" />
         </manifest>
      </jar>
   </target>

   <target name="srcdist" depends="init" description="Generate source distribution">
      <jar destfile="${dist}/lib/jFreeRails-${DSTAMP}-src.jar" basedir=".">
         <include name="src/**/*.java" />
         
         <include name="src/**/*.html" />

         <include name="build.xml" />

         <include name="src/jfreerails/data/*.xml" />

         <include name="src/jfreerails/data/*.png" />

         <include name="src/jfreerails/data/*.dtd" />
         
         <include name="src/jfreerails/data/*.gif" />

         <include name="README" />

         <include name="TODO" />

         <include name="ChangeLog" />
      </jar>
   </target>

   <target name="clean" description="Clean up build and distribution" depends="init">
      <delete dir="${build}" />

      <delete dir="${dist}" />

      <delete dir="${doc}" />

      <delete dir="${temp}" />
   </target>

   <target name="run" depends="compile" description="Test run based on compile">
      <java classname="jfreerails.RunFreerails" fork="true">
         <classpath>
            <pathelement path="${build}" />
         </classpath>
      </java>
   </target>

   <target name="rundist" depends="bindist" description="Test run based on bindist">
      <java jar="${dist}/lib/jFreeRails-${DSTAMP}-bin.jar" fork="true" />
   </target>

   <target name="javadoc" depends="mkdirs, init">
      <javadoc destdir="${doc}" author="true" version="true"  overview="${src}/overview.html" Private="true"  use="true" windowtitle="JFreerails API - build ${DSTAMP}">
         <fileset dir="${src}" defaultexcludes="yes">
            <include name="**/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </javadoc>
	   <!-- now copy the html	-->
	  <copy todir="${doc}">
         <fileset dir="${src}">
            <include name="**/*.html" />
			<include name="**/*.htm" />
			
			<!--Don't copy these since the javadoc tool processes with them -->
            <exclude name="**/overview.html" /> 
			<exclude name="**/package.html" />      
         </fileset>
      </copy>
   </target>

  <!--  depends="javadoc" -->
   <target name="jar_doc" depends="javadoc" description="Jar up javadoc">
      <jar destfile="${dist}/lib/jFreeRails-${DSTAMP}-javadoc.jar" basedir=".">
         <include name="javadoc/**/*" />
      </jar>
   </target>

   <target name="all_dist" depends="jar_doc, bindist, srcdist" description="Create binary, source, and javadoc jars">
   </target>

<!-- Requires that NetComponents.jar is in ant/lib -->
   <target name="upload" depends="all_dist" description="Upload source, binary, and javadocs jar files to sourcforge">
      <ftp server="upload.sourceforge.net" userid="anonymous" password="me@myorg.com" remotedir="/incoming" binary="yes">
         <fileset dir="${dist}/lib">
            <include name="*.jar" />
         </fileset>
      </ftp>
   </target>

	<target name="copy_world_src" depends="mkdirs, init" description="Copies the files world/**/*java  to dist/world_scr" >
		<delete dir="${dist}/world_scr" />
		<mkdir dir="${dist}/world_scr" />
      <copy todir="${dist}/world_scr">
         <fileset dir="${src}">
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
     </target>
     
     
     <!-- The checkdep target tests the dependencies of packages.  It does this by copying the contents of the package 
     in question together with the contents of the packages it is allowed to depend on to a tempory directory, then compiling
     the contents of the package.  If the packaged depends on classes other than those contained in the packages it is allowed
     to depend on, the compile will fail.
     -->               

   <target name="checkdep" depends="compile" description="Tests whether dependencies between packages conform to the rules defined in this target">

	  <!-- Check dependencies for jfreerails.world.common.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/common/*.java"/>
      <delete dir="${temp}" />     
      
      
	  <!-- Check dependencies for jfreerails.world.tilemap.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/world/tilemap/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/tilemap/*.java"/>
      <delete dir="${temp}" /> 
      
       <!-- Check dependencies for jfreerails.world.terrain.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/world/terrain/*.java" />
         	<include name="jfreerails/world/tilemap/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/terrain/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.track.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/world/track/*.java" />
         	<include name="jfreerails/world/terrain/*.java" />
         	<include name="jfreerails/world/tilemap/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/track/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.cargo.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/cargo/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.train.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/train/*.java" />
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <include name="jfreerails/util/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/train/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.station.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/station/*.java" />
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/station/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.stats.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">           
         	<include name="jfreerails/world/stats/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/stats/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.financial.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">           
         	<include name="jfreerails/world/financial/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/financial/*.java"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/world/**/*.java"/>
      <delete dir="${temp}" />     
      
      <!-- Check dependencies for jfreerails.move.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/move/*.java"/>
      <delete dir="${temp}" />        
      
      <!-- Check dependencies for jfreerails.controller.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/controller/**/*.java"/>
      <delete dir="${temp}" />    
      
      <!-- Check dependencies for jfreerails.client.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/client/**/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/client/**/*.java"/>
      <delete dir="${temp}" />    
      
      <!-- Check dependencies for jfreerails.client.common.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/client/common/*.java"/>
      <delete dir="${temp}" />   
      
     <!-- Check dependencies for jfreerails.client.renderer.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         		<include name="jfreerails/client/renderer/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/client/renderer/*.java"/>
      <delete dir="${temp}" />   
      
       <!-- Check dependencies for jfreerails.client.event.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         		<include name="jfreerails/client/event/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/client/event/*.java"/>
      <delete dir="${temp}" />   
      
      <!-- Check dependencies for jfreerails.client.menu.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         		<include name="jfreerails/client/menu/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/client/menu/*.java"/>
      <delete dir="${temp}" />   
      
       <!-- Check dependencies for jfreerails.client.view.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/client/view/*.java" />
         	<include name="jfreerails/client/renderer/*.java" />
         	<include name="jfreerails/client/event/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac srcdir="${temp}" fork="true" includes="jfreerails/client/view/*.java"/>
      <delete dir="${temp}" />  

   </target>
</project>

