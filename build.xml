<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="bindist" name="jFreeRails">
    
   <description>The aim of the FreeRails project is to create a fun game based off the RailRoad Tycoon and RailRoad Tycoon II games.</description>

   <target depends="properties" name="init">
      <tstamp />

      <property location="src" name="src"/>

      <property location="build" name="build"/>

      <property location="dist" name="dist"/>

      <property location="javadoc" name="doc"/>

      <property location="temp" name="temp"/>
   </target>

   <target depends="init" description="Make build directories" name="mkdirs">
      <tstamp />

      <mkdir dir="${build}" />

      <mkdir dir="${dist}/lib" />
      
      <mkdir dir="${dist}/latest" />
      
   </target>

   <target if="eclipse.running" name="properties">
      <property name="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter" />
   </target>

   <target depends="init" description="Copy data files" name="copydata">
      <copy todir="${build}/jfreerails">
         <fileset dir="${src}/jfreerails">
            <include name="**/*.xml" />

            <include name="**/*.png" />

            <include name="**/*.dtd" />
            
             <include name="**/*.gif" />
             <include name="client/view/game_controls.html"/>
         </fileset>
      </copy>

      <copy todir="${build}">
         <fileset dir=".">
            <include name="README" />

            <include name="TODO" />

            <include name="ChangeLog" />
         </fileset>
      </copy>
   </target>

   <target depends="copydata" description="Build everything except JUnit test-classes" name="compile">
      <javac destdir="${build}" fork="true" srcdir="${src}">
         <exclude name="**/*Test.java" />
      </javac>
   </target>

   <target depends="copydata" description="Build everything including JUnit test-classes. Include debugging symbols" name="debugcompile">
      <javac destdir="${build}" fork="true" srcdir="${src}" debug="true" />
   </target>

   <target depends="debugcompile" description="Run all junit tests" name="runtests">
      <junit haltonfailure="yes" printsummary="yes">
         <classpath>
            <pathelement location="${build}" />

            <pathelement path="${java.class.path}" />
         </classpath>

         <formatter type="brief" usefile="no" />

         <batchtest fork="yes">
            <fileset dir="${build}">
               <include name="**/*Test.class" />
            </fileset>
         </batchtest>
      </junit>
   </target>

   <target depends="compile, mkdirs" description="Generate binary distribution" name="bindist">
      <jar basedir="${build}" destfile="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-bin.jar">
         <manifest>
            <attribute name="Main-Class" value="jfreerails.RunFreerails" />
         </manifest>
      </jar>
      <!-- Replace current latest with the jar file we have just created. -->
      	<delete >      		
      		<fileset dir="${dist}/latest/" includes ="jFreeRails-*-bin.jar"/>      		
      	</delete>      	      
      <copy file="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-bin.jar" todir="${dist}/latest"/>      
      
   </target>

   <target depends="mkdirs" description="Generate source distribution" name="srcdist">
      <jar basedir="." destfile="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-src.jar">
         <include name="src/**/*.java" />
         
         <include name="src/**/*.html" />
         
         <include name="src/**/*.form" />

         <include name="build.xml" />

         <include name="src/jfreerails/**/*.xml" />

         <include name="src/**/*.png" />

         <include name="src/**/*.dtd" />
         
         <include name="src/**/*.gif" />

         <include name="README" />

         <include name="TODO" />

         <include name="ChangeLog" />
      </jar>
      
       <!-- Replace current latest with the jar file we have just created. -->
      	<delete >      		
      		<fileset dir="${dist}/latest/" includes ="jFreeRails-*-src.jar"/>      		
      	</delete>      	      
      <copy file="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-src.jar" todir="${dist}/latest"/>      
   </target>

   <target depends="init" description="Clean up build and distribution" name="clean">
      <delete dir="${build}" />

      <delete dir="${dist}/latest" />

      <delete dir="${doc}" />

      <delete dir="${temp}" />
   </target>

   <target depends="mkdirs, compile" description="Test run based on compile" name="run">
      <java classname="jfreerails.RunFreerails" fork="true">
         <classpath>
            <pathelement path="${build}" />
         </classpath>
      </java>
   </target>

   <target depends="bindist" description="Test run based on bindist" name="rundist">
      <java fork="true" jar="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-bin.jar"/>
   </target>

   <target depends="mkdirs, init" name="javadoc">
      <javadoc Private="true" author="true" destdir="${doc}" overview="${src}/overview.html" use="true" version="true" windowtitle="JFreerails API - build ${DSTAMP}">
         <fileset defaultexcludes="yes" dir="${src}">
            <include name="**/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </javadoc>
	   <!-- now copy the html	-->
	  <copy todir="${doc}">
         <fileset dir="${src}">
            <include name="**/*.html" />
			<include name="**/*.htm" />
			
			<!--Don't copy these since the javadoc tool processes them -->
            <exclude name="**/overview.html" /> 
			<exclude name="**/package.html" />      
         </fileset>
      </copy>
   </target>

  
   <target depends="javadoc" description="Jar up javadoc" name="jar_doc">
      <jar basedir="." destfile="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-javadoc.jar">
         <include name="javadoc/**/*" />
      </jar>
      <!-- Replace current latest with the jar file we have just created. -->
      <delete >      		
      		<fileset dir="${dist}/latest/" includes ="jFreeRails-*-javadoc.jar"/>      		
      	</delete>      	      
      <copy file="${dist}/lib/jFreeRails-${DSTAMP}-${TSTAMP}-javadoc.jar" todir="${dist}/latest"/>            
   </target>

   <target depends="jar_doc, bindist, srcdist" description="Create binary, source, and javadoc jars" name="all_dist">
   </target>

<!-- Requires that NetComponents.jar is in ant/lib -->
   <target depends="all_dist" description="Upload source, binary, and javadocs jar files to sourcforge" name="upload">
      <ftp binary="yes" password="me@myorg.com" remotedir="/incoming" server="upload.sourceforge.net" userid="anonymous">
         <fileset dir="${dist}/latest">
            <include name="*.jar" />
         </fileset>
      </ftp>
   </target>

	<target depends="mkdirs, init" description="Copies the files world/**/*java  to dist/world_scr" name="copy_world_src">
		<delete dir="${dist}/world_scr" />
		<mkdir dir="${dist}/world_scr" />
      <copy todir="${dist}/world_scr">
         <fileset dir="${src}">
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
     </target>
     
     
     <!-- The checkdep target tests the dependencies of packages.  It does this by copying the contents of the package 
     in question together with the contents of the packages it is allowed to depend on to a tempory directory, then compiling
     the contents of the package.  If the packaged depends on classes other than those contained in the packages it is allowed
     to depend on, the compile will fail.
     -->               

   <target depends="compile" description="Tests whether dependencies between packages conform to the rules defined in this target" name="checkdep">

	  <!-- Check dependencies for jfreerails.world.common.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/common/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />     
            	  
       <!-- Check dependencies for jfreerails.world.terrain.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/world/terrain/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/terrain/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.track.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/world/track/*.java" />
         	<include name="jfreerails/world/terrain/*.java" />         	
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/track/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.cargo.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/cargo/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.train.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/train/*.java" />
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <include name="jfreerails/util/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/train/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" /> 
      
      <!-- Check dependencies for jfreerails.world.city.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/train/*.java" />
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <include name="jfreerails/util/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/city/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" /> 
      
      
      <!-- Check dependencies for jfreerails.world.station.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">         
         	<include name="jfreerails/world/station/*.java" />
         	<include name="jfreerails/world/cargo/*.java" />
            <include name="jfreerails/world/common/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/station/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" /> 
      
      
      <!-- Check dependencies for jfreerails.world.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/world/**/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />     
      
      <!-- Check dependencies for jfreerails.accounts.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
			<include name="jfreerails/accounts/**/*.java" />         
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/accounts/**/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />     
      
      
      <!-- Check dependencies for jfreerails.move.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/move/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />        
      
      <!-- Check dependencies for jfreerails.controller.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/accounts/**/*.java" />         
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/controller/**/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />    
      
      <!-- Check dependencies for jfreerails.server.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
        	<include name="jfreerails/server/**/*.java" />        	
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
         	<include name="jfreerails/accounts/**/*.java" />         
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/server/**/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />    
      
      
      <!-- Check dependencies for jfreerails.client.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/client/**/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
    		<include name="jfreerails/accounts/**/*.java" />         
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/client/**/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />    
      
      <!-- Check dependencies for jfreerails.client.common.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
    		<include name="jfreerails/accounts/**/*.java" />         
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/client/common/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />   
      
     <!-- Check dependencies for jfreerails.client.renderer.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
       		<include name="jfreerails/client/renderer/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
         	<include name="jfreerails/accounts/**/*.java" />         
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/client/renderer/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />   
      
       <!-- Check dependencies for jfreerails.client.event.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         	<include name="jfreerails/client/event/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/client/event/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />   
      
      <!-- Check dependencies for jfreerails.client.menu.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
         		<include name="jfreerails/client/menu/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/client/menu/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />   
      
       <!-- Check dependencies for jfreerails.client.view.*  -->     
      <mkdir dir="${temp}" />
      <copy todir="${temp}">
         <fileset dir="${src}">
			<include name="jfreerails/client/view/*.java" />
         	<include name="jfreerails/client/renderer/*.java" />
         	<include name="jfreerails/client/event/*.java" />
         	<include name="jfreerails/client/common/*.java" />
         	<include name="jfreerails/controller/**/*.java" />
         	<include name="jfreerails/move/*.java" />
            <include name="jfreerails/world/**/*.java" />
            <include name="jfreerails/util/*.java" />
            <include name="it/unimi/dsi/fastUtil/*.java" />
            <exclude name="**/*Test.java" />
         </fileset>
      </copy>
      <javac fork="true" includes="jfreerails/client/view/*.java" srcdir="${temp}"/>
      <delete dir="${temp}" />  

   </target>
</project>
